# Task Server container

Containerized taskserver for testing and debugging purposes. All commands shown
below are executed from this directory. You will need
[docker](https://docs.docker.com/install/) installed and docker daemon running.


# Build


Simple build can be done by running:

```sh
docker build -t taskd-alpine .
```

Dockerfile has been optimized for speed of building. Most of the configuration
is statically stored in `certs/`, `server/`,and `user/` directories. 

User and server certificates are generated by pki infrastructure provided by
taskd. See [vars](certs/vars) that were used for cert generation. Additionally
client key has been coverted to PKCS8 DER format to be compatible with Java
client.

If you want to add more pre-created data (tasks) modify [tx.data](user/tx.data)
file and rebuild the container. 


# Run

After you built the container you can run it with the following command:

```sh
docker run --tty --interactive -p 53589:53589 taskd-alpine
```

Task Server listens on 53589 port. The command above will map the port to the
same port on your `localhost`. If you have a conflicting service listening on
the same port then modify `-p` flag argument ([see
how](https://docs.docker.com/engine/reference/run/#expose-incoming-ports))

You will need the container running before you can run JUnit tests, as tests
are expecting a running server on 53589 port. Modify 
[test properties](../src/test/resources/taskwarrior.properties) if you need
to change expected port or address of the server




# Reference materials

- [Dockerfile reference ](https://docs.docker.com/engine/reference/builder/)

- [Alpine taskd package](https://pkgs.alpinelinux.org/package/edge/main/x86_64/taskd)

- [Alpine task package](https://pkgs.alpinelinux.org/package/edge/main/x86_64/task)
